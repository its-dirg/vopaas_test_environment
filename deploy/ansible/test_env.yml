- hosts: all

  vars:
    home_dir: "/home/vagrant"
    pysaml2_dir: "{{ home_dir }}/pysaml2"
    pyff_dir: "{{ home_dir }}/pyff"
    metadata_dir_name: "metadata"
    pyff_metadata_dir: "{{ pyff_dir }}/{{ metadata_dir_name }}"
    metadata_static_dir: "{{ home_dir }}/{{ metadata_dir_name }}"
    metadata_dir_sp: "{{ metadata_static_dir }}/sp.xml"
    metadata_dir_idp1: "{{ metadata_static_dir }}/idp1.xml"
    metadata_dir_idp2: "{{ metadata_static_dir }}/idp2.xml"
    hostname: "127.0.0.1"
    host: "http://{{ hostname }}"
    pyff_port: "9090"
    idp_1_port: "9088"
    idp_2_port: "9089"
    proxy_port: "9091"
    sp_port: "9087"
    op_port: "9086"
    pyff_url: "{{ host }}:{{ pyff_port }}"
    sp_url: "{{ host }}:{{ sp_port }}"
    op_host: "https://{{ hostname }}"
    cert_dir: "{{ home_dir }}/certs"

    op_cert_dir: "{{ cert_dir }}/op"
    op_cert: "{{ op_cert_dir }}/localhost.crt"
    op_key: "{{ op_cert_dir }}/localhost.key"
    pyoidc_dir: "{{ home_dir }}/pyoidc"
    op_dir: "{{ pyoidc_dir }}/oidc_example/op2"
    vopaas_dir: "{{ home_dir }}/vopaas"
    proxy_dir: "{{ vopaas_dir }}/example"
    sp_dir: "{{ pysaml2_dir }}/example/sp-wsgi"
    idp_dir: "{{ pysaml2_dir }}/example/idp2"

#  pre_tasks:
#    - name: create directory for certs
#      file: path={{ cert_dir }} state=directory owner=vagrant group=vagrant mode=0755
#
#    - name: create directory for op certs
#      file: path={{ op_cert_dir }} state=directory owner=vagrant group=vagrant mode=0755
#    - name: copy op cert
#      copy: src=localhost.crt dest={{ op_cert }} owner=vagrant group=vagrant mode=0755
#    - name: copy op private key
#      copy: src=localhost.key dest={{ op_key }} owner=vagrant group=vagrant mode=0755
#
#    - name: install apt pkg
#      apt: pkg={{ item }} state=present update_cache=yes
#      with_items:
#        - build-essential
#        - git
#        - python-dev
#        - libssl-dev
#        - libffi-dev
#        - xmlsec1
#        - libxml2
#        - libxslt1.1
#        - libyaml-dev
#        - libxml2-dev
#        - libxslt1-dev
#        - libxslt-dev
#        - vim
#        - python-setuptools
#        - python-libxslt1
#        - python-libxml2
#        - python-pip
#        - python3-pip
#        - python3-tk
#      sudo: Yes


  roles:
    - {role: pyff, sudo: yes}
    - {role: sp, sudo: yes}
    - {role: idps, sudo: yes}
    - {role: op, sudo: yes}
    - {role: vopaas_proxy, sudo: yes}
###    - {role: integration_test, sudo: yes}
    - {role: metadata, sudo: yes}
    - {role: startup, sudo: yes}
